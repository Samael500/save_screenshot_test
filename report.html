<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>report</title>
    <link rel="stylesheet" href="markdown.css" />
    <script src="jquery.min.js"></script>
    <script src="Chart.min.js"></script>
</head>
<body>

<article class="body">
<h1>Ралли на браузерах</h1>

<p>Собственный проект <a href="http://wbtech.pro/">WB&mdash;Tech</a> по комментированию скриншотов <a href="http://coment.me/">coment.me</a> на сегодняшний день, для получения снимка сайта, использует связку <code>selenium + firefox</code>. Данный подход решает задачи получения скриншота, однако тратит достаточно много памяти, и к тому же со временем накапливается большое количество повисших процессов, что в свою очередь приводит к подвисанию сервиса. В связи с этим, необходимо исследовать доступные варианты и определить наилучший из браузеров для автоматического создания скриншотов.</p>

<p>Критерииями для выбора победителя будут являтся:</p>

<ul>
    <li>Качество скриншотов</li>
    <li>Скорость работы</li>
    <li>Затрачиваемые ресурсы</li>
</ul>

<h2>Участники соревнований</h2>

<p>На участие в ралли были отобранны следующие кандидаты:</p>

<ul>
    <li>Firefox <code>36.0.1</code></li>
    <li>Google Chrome <code>41.0.2272.89</code></li>
    <li>Chromium <code>Not tested</code></li>
    <li><a href="http://splash.readthedocs.org/en/latest/">Splash</a> <code>1.5</code></li>
    <li><a href="http://ghost-py.readthedocs.org/en/latest/">Ghost.py</a> <code>0.1.1</code></li>
    <li><a href="https://github.com/ryanpetrello/python-zombie/">Zombie.js</a> <code>0.2.0</code></li>
    <li><a href="http://phantomjs.org/">Pantom.js</a> <code>1.9.8</code>, <code>2.0.0</code></li>
    <li><a href="http://slimerjs.org/">Slimer.js</a> <code>0.9.5</code>, <code>0.10.0pre</code></li>
</ul>

<p>Познакомимся с участниками поближе:</p>

<ul>
    <li><em>Firefox</em> &mdash; наиболее массовый не WebKit браузер на сегодняшний день.</li>
    <li><em>Google Chrome</em> / <em>Chromium</em> &mdash; один из самых быстрых и популярных браузеров.</li>
    <li><em>Splash</em> &mdash; легкий браузер с поддержкой javascript реализовыннй на python-е предоставляюший для управления http api.</li>
    <li><em>Ghost.py</em> &mdash; python браузер с поддержкой javascript ориентированный на автоматическое функциональное тестирование.</li>
    <li><em>Zombie.js</em> &mdash; легкий и быстрый безголовый браузер для автоматического тестирования основаный на node.js</li>
    <li><em>Phantom.js</em> &mdash; быстрый безголовый браузер на движке WebKit со встроенной поддержкой svg. Управляется при помощи javascript api.</li>
    <li><em>Slimer.js</em> &mdash; быстрый браузер, похожий на phantomjs, однако использует движек Gecko от firefox. Управляется при помощи javascript api.</li>
</ul>

<p>Итак, участники отобраны, и готовы показать себя во всей красе, что ж &mdash; приступим к соревнованиям.</p>

<h2>Трасса</h2>

<p><img src="im/rally.jpg" alt="rally"></p>

<p>Для наших, замечательных конкурсантов, предстоит пройти трек по пересеченной местности c четырьмя крутыми поворотами с 16-ю чекпоинтами, а именно: показать свои навыки на следующих ресурсах:</p>

<ul>
    <li><a href="https://google.com/">https://google.com/</a></li>
    <li><a href="https://www.facebook.com/">https://www.facebook.com/</a></li>
    <li><a href="http://habrahabr.ru/">http://habrahabr.ru/</a></li>
    <li><a href="http://wbtech.pro/">http://wbtech.pro/</a></li>
</ul>

<p>при следующих разрешениях экранов по ширине: <code>240</code>, <code>780</code>, <code>1320</code>, <code>1920</code> пикселей.</p>

<h2>Заезд первый &mdash; &laquo;Качество&raquo;</h2>

<blockquote>
    <p>Качество &mdash; это делать что-либо правильно, даже когда никто не смотрит.</p>
</blockquote>

<p>Поскольку, в конечном счете, результат должен быть не хуже, чем имеющийся на настоящий момент &mdash; эталоном качества будут выступать снимки <code>firefox</code>-а.</p>

<p>На данном этапе сошли с дистанции сразу 4 участника. Причем, если бы я делал ставки, то проиграл бы, ведь хром, которого я считал фаворитом соревнований, оказался абсолютно некомпетентным участником.</p>

<h4>Только видимая область</h4>

<p>Для связки <code>selenium</code>-а и <code>google chrome</code> необходимо использовать <code>chromedriver</code> текущая стабильная версия <code>2.14</code>. И, как оказалось, в нем содержится баг, который тянется с 2013 года, известным <a href="https://code.google.com/p/chromedriver/issues/detail?id=294">issue</a>. Хром драйвер не пролистывает окно браузера при захвате изображения, а делает снимок видимой области.</p>

<blockquote>
    <p><img src="im/chrome.png" alt="chrome fail" class="screenshot"></p>
</blockquote>

<p>Так что <code>Google Chrome</code> и <code>Chromium</code> не прошли данный этап.</p>

<h4>Неверный resize</h4>

<p>Безголовый браузер <code>Splash</code>, запускается демоном и слушает <code>localhost:8050</code>, по которому предоставляет <code>http api</code> управления браузером. Для сохранения скриншота необходимо указать адрес сайта и ширину окна браузера.</p>

<div class="highlight highlight-python">
<pre>request <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>http://localhost:8050/render.png?<span class="pl-cce">\</span></span>
<span class="pl-s">url=<span class="pl-c1">{url}</span>&amp;width=<span class="pl-c1">{res}</span>&amp;render_all=1&amp;wait=1<span class="pl-pds">'</span></span>.format(<span class="pl-smi">url</span><span class="pl-k">=</span>url, <span class="pl-smi">res</span><span class="pl-k">=</span>res)
res <span class="pl-k">=</span> subprocess.check_call([<span class="pl-s"><span class="pl-pds">'</span>curl<span class="pl-pds">'</span></span>, request, <span class="pl-s"><span class="pl-pds">'</span>-o<span class="pl-pds">'</span></span>, save_as])</pre></div>

<p>Однако, как оказалось, ширина окна браузера всегда 1024px, а параметр <code>width</code> влияет только на фактическую ширину полученного изображения, к тому же сжатого как thumbnail.</p>

<blockquote>
    <p>240px<br><img src="im/splash.png" alt="splash" class="screenshot"></p>
    <hr>
    <p>780px<br><img src="im/splash_big.png" alt="splash big" class="screenshot"></p>
</blockquote>

<p>Так что splash не прошел данный этап.</p>

<h4>&laquo;Что я вообще сдесь делаю&raquo; &copy; Zombie</h4>

<p><img src="im/zombie.jpg" alt="zombie"></p>

<p>Как оказалось, зомби вообще не умеет делать скриншоты, поэтому выбывает из соревнований.</p>

<h4>Фальшивые паспорта &mdash; старый гугл</h4>

<p>Некоторые из участников соревнований, а именно <code>Phantom.js</code> и <code>Slimer.js</code>, не смогли бы пройти все этапы ралли, под своими именами, поэтому пришлось выдать им фальшивые паспорта.</p>

<p>Google выдает различные версии сайта, в зависимости от того: какой user agent у браузера запрашивающего страницу, и если этот агент неизвестный или старый, то выдается старая версия гугл, с черной полоской меню.</p>

<blockquote>
    <p>Phantom.js 240px<br><img src="im/old_google_phantom.png" alt="old google" class="screenshot"></p>
    <hr>
    <p>Slimer.js 240px<br><img src="im/old_google_slimer.png" alt="old google 2" class="screenshot"></p>
</blockquote>

<p>Но при использовании поддельных паспортов, от <code>firefox</code> результат такой как нужно.</p>

<div class="highlight highlight-python"><pre><span class="pl-s"><span class="pl-pds">'</span>Mozilla/5.0 (X11; Linux x86_64) Gecko/20100101 Firefox/36.0<span class="pl-pds">'</span></span></pre></div>

<blockquote>
    <p><img src="im/google.png" alt="google ok" class="screenshot"></p>
</blockquote>

<h4>Пикселизация &mdash; выколи глаза.</h4>

<p><code>Ghost.py</code> не очень хорошо умеет захватывать картинки, логотип google выглядит похожим на забор.</p>

<blockquote>
    <p><img src="im/ghost.png" alt="ghost" class="screenshot"></p>
</blockquote>

<p>Хоть это и недопустимо, однако, ограничимся предупреждением, и пропустим
призрака в следующий тур.</p>

<h3>Результаты первого заезда</h3>

<p>Во второй тур прошли 4 участника и 4 участника покинули соревнования. Турнирная таблица по окончанию первого этапа.</p>

<ul>
    <li><img class="emoji" title=":white_check_mark:" alt=":white_check_mark:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2705.png" height="20" width="20" align="absmiddle"> Firefox</li>
    <li><img class="emoji" title=":white_check_mark:" alt=":white_check_mark:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2705.png" height="20" width="20" align="absmiddle"> Pantom.js</li>
    <li><img class="emoji" title=":white_check_mark:" alt=":white_check_mark:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2705.png" height="20" width="20" align="absmiddle"> Slimer.js</li>
    <li><img class="emoji" title=":warning:" alt=":warning:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png" height="20" width="20" align="absmiddle"> Ghost.py</li>
    <li><img class="emoji" title=":x:" alt=":x:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/274c.png" height="20" width="20" align="absmiddle"> Chromium</li>
    <li><img class="emoji" title=":x:" alt=":x:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/274c.png" height="20" width="20" align="absmiddle"> Google Chrome</li>
    <li><img class="emoji" title=":x:" alt=":x:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/274c.png" height="20" width="20" align="absmiddle"> Splash</li>
    <li><img class="emoji" title=":x:" alt=":x:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/274c.png" height="20" width="20" align="absmiddle"> Zombie.js</li>
</ul>

<h2>Заезд второй &mdash; &laquo;Скорость&raquo;</h2>

<p><img src="im/speed.jpg" alt="speed"></p>

<p>На данном этапе измерялось время, необходимое для создания браузера, открытия нужной страницы, изменения ширины окна до заданной, сохранения страницы как изображения PNG, закрытия страницы и уничтожения объекта браузера.</p>

<p>Измерения проводились при помощи стандартной библиотеки <code>time</code>, как разница времени между началом запуска функции и её окончания.</p>

<div class="highlight highlight-python"><pre><span class="pl-k">import</span> time
<span class="pl-c"># ...</span>
        start <span class="pl-k">=</span> time.time()
        <span class="pl-c"># call test browser fun()</span>
        end <span class="pl-k">=</span> time.time()
<span class="pl-c"># ...</span>
        times.append(end <span class="pl-k">-</span> start)</pre></div>

<p><strong>Легенда:</strong>
    <ul class="browsers1"></ul>
</p>
<h5>Time</h5>
<div><canvas id="canvas-time"></canvas></div>

<h3>Результаты второго заезда</h3>

<p>В ходе данного этапа, участники заняли следующие места:</p>

<ol>
    <li>Phantom.js <code>2.x</code></li>
    <li>Phantom.js <code>1.x</code></li>
    <li>Ghost.py</li>
    <li>Phantom.js <code>1.x</code> + selenium</li>
    <li>Phantom.js <code>2.x</code> + selenium</li>
    <li>Slimer.js <code>9.x</code></li>
    <li>Slimer.js <code>10.x</code></li>
    <li>Firefox + selenium</li>
</ol>

<p>В результате, ни один из участников не оказался значительно хуже чем <code>firefox</code>, поэтому выбывших нет, все переходят к следующему этапу.</p>

<h2>Заезд третий &mdash; &laquo;Ресурсы&raquo;</h2>

<p><img src="im/fuel.jpg" alt="fuel"></p>

<p>Учитывалась память, которую тратит главный процесс, и все его дочерние процессы. Память измерялась при помощи функции <code>memory_usage</code> библиотеки <code>memory_profiler</code> с указанием параметра <code>include_children</code>.</p>

<p>Измерялась минимальная, средняя, и максимальная память для каждого скриншота.</p>

<div class="highlight highlight-python"><pre><span class="pl-k">from</span> memory_profiler <span class="pl-k">import</span> memory_usage
<span class="pl-c"># ...</span>
        memory <span class="pl-k">=</span> memory_usage((fun, args), <span class="pl-smi">include_children</span><span class="pl-k">=</span><span class="pl-c1">True</span>)
<span class="pl-c"># ...</span>
        mins.append(<span class="pl-c1">min</span>(memory))
        maxs.append(<span class="pl-c1">max</span>(memory))
        avgs.append(avg(memory))</pre></div>

<h4>Ненасытное привидение</h4>

<p><code>Ghost.py</code> &mdash; оказался чрезвычайно прожорливым, занимая всю доступную память, доходил до максимума и вылетал. Единственный из участников, кто не сумел пройти все 16 чекпоинтов за один подход.</p>

<p>Учитывая вынесенное ранее предупреждение, призрак вылетает из конкурса!</p>

<blockquote>
    <p>I ain't afraid of no ghosts</p>
</blockquote>

<p><img src="im/ghostbusters.png" alt="ghostbusters"></p>

<h4>
<a id="user-content-Двуличный-хитрец" class="anchor" href="#%D0%94%D0%B2%D1%83%D0%BB%D0%B8%D1%87%D0%BD%D1%8B%D0%B9-%D1%85%D0%B8%D1%82%D1%80%D0%B5%D1%86" aria-hidden="true"><span class="octicon octicon-link"></span></a>Двуличный хитрец</h4>

<p>Оказалось, что <code>Slimer.js</code> притворяется: запускается дочерний процесс <code>slimerjs</code>,
который потребляет не более 3&nbsp;Mb памяти, но при этом запускает ещё один
дочерний процесс с именем <code>firefox</code>, который уже добирает память до 300&nbsp;Mb.</p>

<h4>Общие затраты памяти</h4>

<p>Поскольку <code>Ghost.py</code> потребляет уж слишком много ресурсов, на графиках не указывается.</p>

<p><strong>Легенда:</strong>
    <ul class="browsers2"></ul>
</p>
<h5>Memory avg</h5>
<div><canvas id="canvas-memory_max"></canvas></div>

<h5>Memory avg</h5>
<div><canvas id="canvas-memory_avg"></canvas></div>

<h3>Результаты третьего заезда</h3>

<p>В ходе данного этапа, участники заняли следующие места:</p>

<ol>
    <li>Phantom.js <code>1.x</code></li>
    <li>Phantom.js <code>2.x</code></li>
    <li>Phantom.js <code>1.x</code> + selenium</li>
    <li>Phantom.js <code>2.x</code> + selenium</li>
    <li>Slimer.js <code>9.x</code></li>
    <li>Slimer.js <code>10.x</code></li>
    <li>Firefox + selenium</li>
    <li>Ghost.py</li>
</ol>

<p>На этом этапе выбывает <code>Ghost.py</code>, турнирная таблица принимает вид:</p>

<ul>
    <li><img class="emoji" title=":white_check_mark:" alt=":white_check_mark:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2705.png" height="20" width="20" align="absmiddle"> Pantom.js</li>
    <li><img class="emoji" title=":white_check_mark:" alt=":white_check_mark:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2705.png" height="20" width="20" align="absmiddle"> Slimer.js</li>
    <li><img class="emoji" title=":white_check_mark:" alt=":white_check_mark:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2705.png" height="20" width="20" align="absmiddle"> Firefox</li>
    <li><img class="emoji" title=":x:" alt=":x:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/274c.png" height="20" width="20" align="absmiddle"> Ghost.py</li>
</ul>

<h2>Заезд четвертый &mdash; &laquo;Управляемость&raquo;</h2>

<p><img src="im/wet_road.png" alt="wet road"></p>

<p>Несмотря на то, что определилась тройка лидеров и уже можно подвести итоги, рассмотрим как управлять безголовыми браузерами.</p>

<h4>Firefox</h4>

<p><code>Firefox</code> работает в связке с <code>selenium</code>-ом и управляется достаточно просто, единственная особенность &mdash; это то, что браузер запускает графическую оболочку, поэтому нужно использовать виртуальный дисплей.</p>

<div class="highlight highlight-python"><pre><span class="pl-k">from</span> selenium <span class="pl-k">import</span> webdriver
<span class="pl-k">from</span> pyvirtualdisplay <span class="pl-k">import</span> Display
<span class="pl-c"># ...</span>
<span class="pl-k">with</span> Display(<span class="pl-smi">visible</span><span class="pl-k">=</span><span class="pl-c1">0</span>, <span class="pl-smi">size</span><span class="pl-k">=</span>(<span class="pl-c1">1024</span>, <span class="pl-c1">768</span>), <span class="pl-smi">backend</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>xvfb<span class="pl-pds">'</span></span>):
        browser <span class="pl-k">=</span> Browser(<span class="pl-k">**</span>param)
        browser.set_window_size(width, <span class="pl-c1">768</span>)
        browser.get(url)
        browser.save_screenshot(save_as)
        browser.quit()</pre></div>

<h4>Phantom</h4>

<p><code>Phantom.js</code> можно использовать, как самостоятельный безголовый браузер, так и в связке с <code>selenium</code>-ом. Работа с <code>selenium</code>-ом аналогична <code>firefox</code>, за тем лишь исключением, что нет необходимости запускать виртуальный дисплей.</p>

<p>Собственная работа <code>phantom.js</code>, заключается в вызове консольной команды, и передаче ей скрипта для выполнения браузером.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> page <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpage<span class="pl-pds">'</span></span>).create();
page.settings.<span class="pl-c1">userAgent</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Mozilla/5.0 (X11; Linux x86_64) Firefox/36.0<span class="pl-pds">'</span></span>;
page.viewportSize <span class="pl-k">=</span> { width<span class="pl-k">:</span><span class="pl-c1">1920</span>, height<span class="pl-k">:</span><span class="pl-c1">768</span> };
page.<span class="pl-c1">open</span>(<span class="pl-s"><span class="pl-pds">'</span>http://wbtech.pro/<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">status</span>) {
        page.render(<span class="pl-s"><span class="pl-pds">'</span>img/phantomjs2-no_selenium/wbtech.pro-1920px.png<span class="pl-pds">'</span></span>);
        phantom.exit();
});</pre></div>

<p>В python запускаем браузер с помощью стандартной библиотеки <code>subprocess</code>.</p>

<div class="highlight highlight-python"><pre><span class="pl-k">import</span> subprocess
<span class="pl-c"># ...</span>
subprocess.check_call([phantom_path, script_path, <span class="pl-s"><span class="pl-pds">'</span>--ssl-protocol=any<span class="pl-pds">'</span></span>])</pre></div>

<h4>Slimer</h4>

<p><code>Slimer.js</code> работает точно так же, как и <code>phantom.js</code> без <code>selenium</code>-а, но является не совсем безголовым, он запускает графическую оболочку, поэтому требует виртуальный дисплей.</p>

<p>А так же, в ходе тестирования было <a href="http://stackoverflow.com/questions/29280104/slimerjs-takes-a-snapshot-of-only-the-visible-area/">выявлено</a>, что для корректного скриншота нужно всегда, перед открытием страницы, указывать базовую ширину окна браузера.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> page <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpage<span class="pl-pds">'</span></span>).create();
page.viewportSize <span class="pl-k">=</span> { width<span class="pl-k">:</span><span class="pl-c1">1024</span>, height<span class="pl-k">:</span><span class="pl-c1">768</span> };
page.settings.<span class="pl-c1">userAgent</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Mozilla/5.0 (X11; Linux x86_64) Firefox/36.0<span class="pl-pds">'</span></span>;
page.<span class="pl-c1">open</span>(<span class="pl-s"><span class="pl-pds">'</span>http://wbtech.pro/<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">status</span>) {
        page.viewportSize <span class="pl-k">=</span> { width<span class="pl-k">:</span><span class="pl-c1">1920</span>, height<span class="pl-k">:</span><span class="pl-c1">768</span> };
        page.render(<span class="pl-s"><span class="pl-pds">'</span>img/slimerjs10/wbtech.pro-1920px.png<span class="pl-pds">'</span></span>);
        page.<span class="pl-c1">close</span>();
        slimer.exit();
});</pre></div>

<p>В python запускаем браузер с помощью стандартной библиотеки <code>subprocess</code>.</p>

<div class="highlight highlight-python"><pre><span class="pl-k">from</span> pyvirtualdisplay <span class="pl-k">import</span> Display
<span class="pl-k">import</span> subprocess
<span class="pl-c"># ...</span>
<span class="pl-k">with</span> Display(<span class="pl-smi">visible</span><span class="pl-k">=</span><span class="pl-c1">0</span>, <span class="pl-smi">size</span><span class="pl-k">=</span>(<span class="pl-c1">1024</span>, <span class="pl-c1">768</span>), <span class="pl-smi">backend</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>xvfb<span class="pl-pds">'</span></span>):
        subprocess.check_call([slimer_path, script_path, <span class="pl-s"><span class="pl-pds">'</span>--ssl-protocol=any<span class="pl-pds">'</span></span>])</pre></div>

<h2>Финиш</h2>

<p><img src="im/chess_flag.png" alt="chess flag"></p>

<p>Гонка завершилась, пришло время подвести итоги и определить победителей.</p>

<p>До финиша доехали всего три команды, так что тройка лидеров очевидна. Учитывая затраты ресурсов и времени, участники занимают следующие места:</p>

<ol>
    <li>Phantom.js <code>2.x</code></li>
    <li>Phantom.js <code>1.x</code></li>
    <li>Phantom.js <code>1.x</code> + selenium</li>
    <li>Phantom.js <code>2.x</code> + selenium</li>
    <li>Slimer.js <code>9.x</code></li>
    <li>Slimer.js <code>10.x</code></li>
    <li>Firefox + selenium</li>
</ol>

<p>Безоговорочным лидером гонки стал <code>phantom.js</code>, в качестве награды ему будет предложено занять пост <code>firefox</code>-а, на сервисе <a href="http://coment.me/">coment.me</a>.</p>

<p><img src="im/pedestal.png" alt="pedestal"></p>
</article>

<script>

    var LABELS = ['google.com-240px', 'google.com-780px', 'google.com-1320px', 'google.com-1920px', 'www.facebook.com-240px', 'www.facebook.com-780px', 'www.facebook.com-1320px', 'www.facebook.com-1920px', 'habrahabr.ru-240px', 'habrahabr.ru-780px', 'habrahabr.ru-1320px', 'habrahabr.ru-1920px', 'wbtech.pro-240px', 'wbtech.pro-780px', 'wbtech.pro-1320px', 'wbtech.pro-1920px'];

    var FIREFOX = {label: "firefox", fillColor : "rgba(255,140,0,0.03)", strokeColor : "rgba(255,140,0,1)", pointColor : "rgba(255,140,0,1)", pointStrokeColor : "#fff", pointHighlightFill : "#fff", pointHighlightStroke : "rgba(255,140,0,1)", }
    var GHOST = {label: "ghost", fillColor : "rgba(255,0,0,0.03)", strokeColor : "rgba(255,0,0,1)", pointColor : "rgba(255,0,0,1)", pointStrokeColor : "#fff", pointHighlightFill : "#fff", pointHighlightStroke : "rgba(255,0,0,1)", }
    var PHANTOMJS = {label: "phantomjs", fillColor : "rgba(0,255,255,0.03)", strokeColor : "rgba(0,255,255,1)", pointColor : "rgba(0,255,255,1)", pointStrokeColor : "#fff", pointHighlightFill : "#fff", pointHighlightStroke : "rgba(0,255,255,1)", }
    var PHANTOMJS2 = {label: "phantomjs2", fillColor : "rgba(30,144,255,0.03)", strokeColor : "rgba(30,144,255,1)", pointColor : "rgba(30,144,255,1)", pointStrokeColor : "#fff", pointHighlightFill : "#fff", pointHighlightStroke : "rgba(30,144,255,1)", }
    var SLIMERJS = {label: "slimerjs", fillColor : "rgba(0,255,0,0.03)", strokeColor : "rgba(0,255,0,1)", pointColor : "rgba(0,255,0,1)", pointStrokeColor : "#fff", pointHighlightFill : "#fff", pointHighlightStroke : "rgba(0,255,0,1)", }
    var SLIMERJS10 = {label: "slimerjs10", fillColor : "rgba(0,128,0,0.03)", strokeColor : "rgba(0,128,0,1)", pointColor : "rgba(0,128,0,1)", pointStrokeColor : "#fff", pointHighlightFill : "#fff", pointHighlightStroke : "rgba(0,128,0,1)", }
    var PHANTOMJS_NOS = {label: "phantomjs-no_selenium", fillColor : "rgba(0,0,255,0.03)", strokeColor : "rgba(0,0,255,1)", pointColor : "rgba(0,0,255,1)", pointStrokeColor : "#fff", pointHighlightFill : "#fff", pointHighlightStroke : "rgba(0,0,255,1)", }
    var PHANTOMJS2_NOS = {label: "phantomjs2-no_selenium", fillColor : "rgba(25,25,112,0.03)", strokeColor : "rgba(25,25,112,1)", pointColor : "rgba(25,25,112,1)", pointStrokeColor : "#fff", pointHighlightFill : "#fff", pointHighlightStroke : "rgba(25,25,112,1)", }

    var fox_min_mem = $.extend({}, FIREFOX);
    var fox_max_mem = $.extend({}, FIREFOX);
    var fox_avg_mem = $.extend({}, FIREFOX);
    var fox_time = $.extend({}, FIREFOX);
    fox_min_mem['data'] = ['57.51953125', '59.41015625', '59.6796875', '59.84375', '59.66796875', '59.66796875', '59.66796875', '59.67578125', '59.78515625', '59.78515625', '63.09375', '63.06640625', '63.2578125', '63.3125', '63.3125', '63.3125'];
    fox_max_mem['data'] = ['287.5625', '292.8671875', '291.90234375', '296.72265625', '308.2421875', '305.6015625', '295.4453125', '295.94140625', '392.515625', '440.3046875', '442.421875', '471.03515625', '289.375', '296.4921875', '287.6171875', '287.87890625'];
    fox_avg_mem['data'] = ['210.299330704', '214.881805654', '215.846502163', '217.294134298', '227.068700517', '222.908402402', '221.729256281', '220.072563591', '265.278598923', '288.298313949', '288.916726132', '296.593244596', '217.821538061', '220.567548838', '218.372563336', '217.157501515'];
    fox_time['data'] = ['9.29280171394', '7.76297516823', '7.96619474888', '8.01676571369', '9.04521651268', '8.52571070194', '9.11036310196', '9.32324450016', '12.3039075136', '11.9718331099', '12.0818757057', '12.8998947144', '7.29799132347', '7.54998955727', '7.63910048008', '7.79855241776'];

    var ghost_min_mem = $.extend({}, GHOST);
    var ghost_max_mem = $.extend({}, GHOST);
    var ghost_avg_mem = $.extend({}, GHOST);
    var ghost_time = $.extend({}, GHOST);
    ghost_min_mem['data'] = ['57.6484375', '359.71484375', '573.0625', '781.90625', '58.10546875', '433.8515625', '764.20703125', '1097.0546875', '1424.5078125', '1199.08203125', '1265.73046875', '1332.93359375', '1400.609375', '1426.91796875', '1428.3046875', '1438.984375'];
    ghost_max_mem['data'] = ['632.5703125', '1073.0390625', '1481.66796875', '1913.3203125', '775.00390625', '1428.04296875', '2086.30859375', '2745.08203125', '3018.109375', '2997.35546875', '2609.96484375', '2765.0390625', '2773.07421875', '2848.84765625', '2889.0859375', '2872.72265625'];
    ghost_avg_mem['data'] = ['381.481622747', '825.572668425', '1249.1399628', '1668.74281145', '445.894963892', '1088.80533814', '1736.49032419', '2383.10018455', '2864.54675177', '2471.85743496', '2503.62350453', '2656.68014718', '2675.98643762', '2740.80630587', '2761.88476822', '2773.00109655'];
    ghost_time['data'] = ['1.79704072475', '1.46408410072', '1.59935195446', '1.69189586639', '1.80878140926', '2.06640074253', '2.22396113873', '2.49860439301', '4.21526384354', '4.93821661472', '5.09522509575', '5.27006001472', '2.22158868313', '2.32183098793', '2.37284250259', '2.42232656479'];

    var pantom_min_mem = $.extend({}, PHANTOMJS);
    var pantom_max_mem = $.extend({}, PHANTOMJS);
    var pantom_avg_mem = $.extend({}, PHANTOMJS);
    var pantom_time = $.extend({}, PHANTOMJS);
    pantom_min_mem['data'] = ['57.66796875', '58.64453125', '58.65234375', '58.7421875', '58.75', '58.7421875', '58.7421875', '58.56640625', '58.56640625', '58.56640625', '58.56640625', '58.56640625', '61.6484375', '61.6484375', '61.6484375', '61.6484375'];
    pantom_max_mem['data'] = ['213.95703125', '222.84375', '225.83984375', '227.7890625', '216.83984375', '227.91015625', '223.0546875', '226.3359375', '285.3125', '283.93359375', '298.47265625', '307.9453125', '211.3046875', '181.59375', '215.30859375', '218.1953125'];
    pantom_avg_mem['data'] = ['124.599474327', '126.726486845', '129.68963763', '131.309354181', '128.050248147', '129.74143255', '129.838363684', '130.052021994', '177.321901222', '173.7306141', '181.520918631', '192.29892043', '129.388915932', '128.49546131', '130.972538724', '132.348366514'];
    pantom_time['data'] = ['3.33461923599', '2.64778199196', '2.67715289593', '2.84830794334', '2.94201140404', '3.12734394073', '3.08298749924', '3.10927951336', '4.97299025059', '4.79050142765', '5.0937731266', '5.51990280151', '2.38915302753', '2.44013597965', '2.54947547913', '2.74255979061'];

    var phantomjs2_min_mem = $.extend({}, PHANTOMJS2);
    var phantomjs2_max_mem = $.extend({}, PHANTOMJS2);
    var phantomjs2_avg_mem = $.extend({}, PHANTOMJS2);
    var phantomjs2_time = $.extend({}, PHANTOMJS2);
    phantomjs2_min_mem['data'] = ['57.8203125', '58.7421875', '58.8125', '58.86328125', '58.65234375', '58.87890625', '58.88671875', '58.9453125', '58.95703125', '62.609375', '62.6328125', '97.66796875', '97.88671875', '97.88671875', '97.88671875', '97.88671875'];
    phantomjs2_max_mem['data'] = ['228.921875', '233.66015625', '233.76171875', '236.265625', '224.80078125', '260.5859375', '234.41796875', '230.5546875', '287.21484375', '277.0859375', '316.89453125', '340.078125', '256.85546875', '261.2890625', '260.80859375', '265.20703125'];
    phantomjs2_avg_mem['data'] = ['131.255107407', '133.343669884', '133.791692694', '134.779298695', '133.652330626', '133.700697943', '134.159340596', '134.136663913', '177.603508159', '178.04091016', '187.775289549', '227.165835424', '173.087356143', '174.953747331', '174.676914671', '177.352312981'];
    phantomjs2_time['data'] = ['2.73822984695', '2.66407690048', '2.56250739098', '2.55795032978', '2.73078076839', '2.86119656563', '2.77869420052', '2.86394920349', '5.38108596802', '4.79345829487', '5.16334118843', '5.59498693943', '2.68351891041', '2.5996868372', '2.77748160362', '2.80392079353'];

    var slimerjs_min_mem = $.extend({}, SLIMERJS);
    var slimerjs_max_mem = $.extend({}, SLIMERJS);
    var slimerjs_avg_mem = $.extend({}, SLIMERJS);
    var slimerjs_time = $.extend({}, SLIMERJS);
    slimerjs_min_mem['data'] = ['57.76953125', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625', '57.9140625'];
    slimerjs_max_mem['data'] = ['267.78515625', '266.58984375', '271.10546875', '281.0234375', '284.8984375', '281.35546875', '281.7109375', '285.4609375', '403.01953125', '394.69921875', '414.16796875', '450.44140625', '243.55859375', '247.1875', '253.26171875', '259.65625'];
    slimerjs_avg_mem['data'] = ['200.702593128', '200.588082643', '202.421953239', '205.232973811', '208.339219234', '208.643609047', '208.66535544', '208.596524038', '257.706318653', '256.816427542', '260.68009999', '286.41849526', '190.456565739', '191.250788947', '192.584954684', '194.637746241'];
    slimerjs_time['data'] = ['4.39690306187', '3.5953312397', '3.68906276226', '3.98432097435', '4.30194294453', '4.19800000191', '4.32255833149', '4.48725349903', '5.83087739944', '5.54539122581', '5.98717346191', '6.44164443016', '3.50296916962', '3.50648863316', '3.50514521599', '3.99715020657'];

    var slimerjs10_min_mem = $.extend({}, SLIMERJS10);
    var slimerjs10_max_mem = $.extend({}, SLIMERJS10);
    var slimerjs10_avg_mem = $.extend({}, SLIMERJS10);
    var slimerjs10_time = $.extend({}, SLIMERJS10);
    slimerjs10_min_mem['data'] = ['58.1796875', '58.32421875', '58.32421875', '58.32421875', '58.32421875', '58.32421875', '58.32421875', '58.32421875', '58.32421875', '58.328125', '58.328125', '58.328125', '58.328125', '58.328125', '58.328125', '58.328125'];
    slimerjs10_max_mem['data'] = ['258.30078125', '253.97265625', '260.94140625', '266.4921875', '261.55859375', '268.98828125', '268.796875', '280.6875', '415.7421875', '404.92578125', '418.59375', '480.63671875', '250.78515625', '249.3359375', '254.09375', '262.44921875'];
    slimerjs10_avg_mem['data'] = ['194.324623034', '195.522781234', '196.151648992', '198.362083891', '198.893542753', '199.373150986', '200.811052984', '208.111080106', '258.216557083', '260.58229163', '267.800769728', '297.724209103', '191.378782438', '192.566535175', '194.415589111', '196.318028488'];
    slimerjs10_time['data'] = ['4.13471560478', '3.83870270252', '3.89674685001', '4.1415116787', '4.20064232349', '4.38248586655', '4.47859532833', '5.20726921558', '6.56752169132', '6.45744941235', '6.88453192711', '9.92854173183', '5.43037421703', '4.16022388935', '4.29186251163', '4.31718957424'];

    var phantomjs_nos_min_mem = $.extend({}, PHANTOMJS_NOS);
    var phantomjs_nos_max_mem = $.extend({}, PHANTOMJS_NOS);
    var phantomjs_nos_avg_mem = $.extend({}, PHANTOMJS_NOS);
    var phantomjs_nos_time = $.extend({}, PHANTOMJS_NOS);
    phantomjs_nos_min_mem['data'] = ['57.7578125', '57.31640625', '57.31640625', '57.30078125', '57.30078125', '50.73828125', '34.2421875', '34.08984375', '33.828125', '33.84375', '33.84375', '33.84375', '33.84375', '33.84375', '33.84375', '33.84375'];
    phantomjs_nos_max_mem['data'] = ['219.31640625', '214.8046875', '216.1328125', '219.6484375', '212.2421875', '211.48828125', '189.578125', '194.171875', '257.20703125', '253.48046875', '258.94921875', '273.55078125', '180.0', '186.16015625', '187.69921875', '188.37890625'];
    phantomjs_nos_avg_mem['data'] = ['131.670365073', '127.758484909', '129.343963655', '130.774784537', '127.410987663', '128.806087798', '104.341394853', '107.257089286', '152.993849462', '158.275862943', '161.196604224', '174.474177281', '99.7483057324', '103.507046878', '103.637850222', '105.620699295'];
    phantomjs_nos_time['data'] = ['3.06231226921', '2.64720709324', '2.46827688217', '2.56695349216', '2.063539958', '2.85570938587', '2.86592776775', '2.31111850739', '6.32319159508', '5.0160172224', '4.55430297852', '5.43175292015', '1.81632361412', '2.04054441452', '1.99148631096', '2.0746994257'];

    var phantomjs2_nos_min_mem = $.extend({}, PHANTOMJS2_NOS);
    var phantomjs2_nos_max_mem = $.extend({}, PHANTOMJS2_NOS);
    var phantomjs2_nos_avg_mem = $.extend({}, PHANTOMJS2_NOS);
    var phantomjs2_nos_time = $.extend({}, PHANTOMJS2_NOS);
    phantomjs2_nos_min_mem['data'] = ['57.73046875', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375', '57.859375'];
    phantomjs2_nos_max_mem['data'] = ['224.8046875', '223.57421875', '209.77734375', '228.265625', '226.4375', '223.02734375', '217.62109375', '258.73828125', '263.82421875', '265.1875', '268.50390625', '284.921875', '206.79296875', '209.796875', '209.3984375', '213.984375'];
    phantomjs2_nos_avg_mem['data'] = ['127.231317074', '129.084537122', '129.446651603', '131.361211623', '128.03553478', '127.780402555', '127.209328406', '131.926942137', '169.148834365', '170.180055112', '176.063445798', '187.735124869', '122.760366587', '125.091002747', '127.177092634', '128.653984375'];
    phantomjs2_nos_time['data'] = ['2.28697268963', '2.03651404381', '2.04790878296', '2.08723666668', '1.91014184952', '1.93685843945', '1.84506719112', '2.79357130527', '3.7008752346', '3.6100086689', '3.755864501', '4.49910318851', '1.39852902889', '1.5189193964', '1.57745428085', '1.69512104988'];

    var memory_max_data = {labels : LABELS, datasets : [fox_max_mem, phantomjs2_max_mem, pantom_max_mem, slimerjs_max_mem, slimerjs10_max_mem, phantomjs_nos_max_mem, phantomjs2_nos_max_mem] };
    var memory_avg_data = {labels : LABELS, datasets : [fox_avg_mem, phantomjs2_avg_mem, pantom_avg_mem, slimerjs_avg_mem, slimerjs10_avg_mem, phantomjs_nos_avg_mem, phantomjs2_nos_avg_mem] };
    var time_data = {labels : LABELS, datasets : [fox_time, ghost_time, phantomjs2_time, pantom_time, slimerjs_time, slimerjs10_time, phantomjs_nos_time, phantomjs2_nos_time] };

    Chart.defaults.global.bezierCurve = false;
    Chart.defaults.global.responsive = true;
    Chart.defaults.global.animation = false;

    var browsers = [FIREFOX, GHOST, PHANTOMJS, PHANTOMJS2, SLIMERJS, SLIMERJS10, PHANTOMJS_NOS, PHANTOMJS2_NOS];

    var legends = function() {
        for (index in browsers){
            var browser = browsers[index];
            $('ul.browsers1').append('<li class={class} />'.replace('{class}', browser['label']));
            if (browser.label != 'ghost') {
                $('ul.browsers2').append('<li class={class} />'.replace('{class}', browser['label']));
            }
            var li = $('li.{class}'.replace('{class}', browser['label']));
            li.html('<span style="color:{color}"><strong>{text}</strong></span>'.replace('{color}', browser['strokeColor']).replace('{text}', browser['label'].toUpperCase()));
        }
    };

    window.onload = function(){
        // set legends
        legends();
        // memory maximal usage
        var memory_max = document.getElementById("canvas-memory_max").getContext("2d");
        window.myLine = new Chart(memory_max).Line(memory_max_data, {bezierCurve: false});
        // memory avg usage
        var memory_avg = document.getElementById("canvas-memory_avg").getContext("2d");
        window.myLine = new Chart(memory_avg).Line(memory_avg_data, {bezierCurve: false});
        // time usage
        var time_usage = document.getElementById("canvas-time").getContext("2d");
        window.myLine = new Chart(time_usage).Line(time_data, {bezierCurve: false});
    }
</script>

</body>
</html>
